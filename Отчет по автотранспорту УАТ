ВЫБРАТЬ
	уатПутевойЛист.Водитель1 КАК Водитель1,
	уатПутевойЛист.Ссылка КАК Ссылка,
	уатПутевойЛист.ДатаВыезда КАК ДатаВыезда,
	уатПутевойЛист.ДатаЗакрытия КАК ДатаЗакрытия,
	уатПутевойЛист.ТранспортноеСредство.ГаражныйНомер КАК РегистрационныйНомер,
	уатПутевойЛист.ТранспортноеСредство.ТипТС КАК ТранспортноеСредствоТипТС
ПОМЕСТИТЬ ВТШапкаДокумента
ИЗ
	Документ.уатПутевойЛист КАК уатПутевойЛист
ГДЕ
	уатПутевойЛист.Дата МЕЖДУ &ДатаН И &ДатаО
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	уатПутевойЛистВыработкаТС.ТС.КоличествоЕздок КАК ТСКоличествоЕздок,
	уатПутевойЛистВыработкаТС.Ссылка КАК Ссылка
ПОМЕСТИТЬ ВТВыработкаТС
ИЗ
	Документ.уатПутевойЛист.ВыработкаТС КАК уатПутевойЛистВыработкаТС
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	уатПутевойЛистЗадание.КоличествоТонн КАК КоличествоТонн,
	уатПутевойЛистЗадание.КоличествоЧасов КАК КоличествоЧасов,
	уатПутевойЛистЗадание.Ссылка КАК Ссылка,
	уатПутевойЛистЗадание.КоличествоКмГруз КАК КоличествоКмГруз,
	уатПутевойЛистЗадание.КоличествоКмПорожний КАК КоличествоКмПорожний,
	уатПутевойЛистЗадание.ОбъектСтроительства.Код КАК ОбъектСтроительстваКод,
	уатПутевойЛистЗадание.ОбъектСтроительства.Представление КАК ОбъектСтроительстваПредставление,
	уатПутевойЛистЗадание.Выполнено КАК Выполнено,
	уатПутевойЛистЗадание.Маршрут КАК Маршрут,
	уатПутевойЛистЗадание.Номенклатура КАК Номенклатура,
	уатПутевойЛистЗадание.КоличествоЕздок КАК КоличествоЕздок
ПОМЕСТИТЬ ВТЗадание
ИЗ
	Документ.уатПутевойЛист.Задание КАК уатПутевойЛистЗадание
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	уатПутевойЛистВыработкаСотрудников.Ссылка КАК Ссылка,
	ЕСТЬNULL(ВЫБОР
			КОГДА уатПутевойЛистВыработкаСотрудников.ПараметрВыработки.Код = "000001007"
				ТОГДА ВЫБОР
						КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
							ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
						ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
					КОНЕЦ + ВЫБОР
						КОГДА (ВЫРАЗИТЬ((СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
									КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
										ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
									ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
								КОНЕЦ) / 60 КАК ЧИСЛО(15, 0))) * 60 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
								КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
									ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
								ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
							КОНЕЦ
							ТОГДА ВЫРАЗИТЬ((СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
										КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
											ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
										ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
									КОНЕЦ) / 60 КАК ЧИСЛО(15, 0))
						ИНАЧЕ (ВЫРАЗИТЬ((СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
									КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
										ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
									ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
								КОНЕЦ) / 60 КАК ЧИСЛО(15, 0))) - 1
					КОНЕЦ / 100
		КОНЕЦ, 0) КАК ВремяДневное,
	ЕСТЬNULL(ВЫБОР
			КОГДА уатПутевойЛистВыработкаСотрудников.ПараметрВыработки.Код = "000000007"
				ТОГДА ВЫБОР
						КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
							ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
						ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
					КОНЕЦ + ВЫБОР
						КОГДА (ВЫРАЗИТЬ((СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
									КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
										ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
									ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
								КОНЕЦ) / 60 КАК ЧИСЛО(15, 0))) * 60 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
								КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
									ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
								ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
							КОНЕЦ
							ТОГДА ВЫРАЗИТЬ((СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
										КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
											ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
										ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
									КОНЕЦ) / 60 КАК ЧИСЛО(15, 0))
						ИНАЧЕ (ВЫРАЗИТЬ((СУММА(уатПутевойЛистВыработкаСотрудников.Количество) - 3600 * ВЫБОР
									КОГДА (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) * 3600 <= СУММА(уатПутевойЛистВыработкаСотрудников.Количество)
										ТОГДА ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))
									ИНАЧЕ (ВЫРАЗИТЬ(СУММА(уатПутевойЛистВыработкаСотрудников.Количество) / 3600 КАК ЧИСЛО(15, 0))) - 1
								КОНЕЦ) / 60 КАК ЧИСЛО(15, 0))) - 1
					КОНЕЦ / 100
		КОНЕЦ, 0) КАК ВремяНочное
ПОМЕСТИТЬ втВремяВыработкиСотрудника
ИЗ
	Документ.уатПутевойЛист.ВыработкаСотрудников КАК уатПутевойЛистВыработкаСотрудников
ГДЕ
	(уатПутевойЛистВыработкаСотрудников.ПараметрВыработки.Код = "000001007"
			ИЛИ уатПутевойЛистВыработкаСотрудников.ПараметрВыработки.Код = "000000007")

СГРУППИРОВАТЬ ПО
	уатПутевойЛистВыработкаСотрудников.Ссылка,
	уатПутевойЛистВыработкаСотрудников.ПараметрВыработки.Наименование,
	уатПутевойЛистВыработкаСотрудников.ПараметрВыработки.Код
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(ВТШапкаДокумента.ДатаВыезда, ДЕНЬ) КАК ДатаВыезда,
	НАЧАЛОПЕРИОДА(ВТШапкаДокумента.ДатаЗакрытия, ДЕНЬ) КАК ДатаЗакрытия,
	ВТШапкаДокумента.Ссылка КАК Документ,
	ВТШапкаДокумента.Водитель1 КАК Водитель1,
	ВЫБОР
		КОГДА ВТШапкаДокумента.ТранспортноеСредствоТипТС = ЗНАЧЕНИЕ(Справочник.уатТипыТС.ПустаяСсылка)
			ТОГДА "Данные не заполнены"
		ИНАЧЕ ВТШапкаДокумента.ТранспортноеСредствоТипТС
	КОНЕЦ КАК ВидТранспортногоСредства,
	ВТШапкаДокумента.РегистрационныйНомер КАК РегистрационныйНомер,
	ВТЗадание.ОбъектСтроительстваКод КАК КодОбъектаСтроительства,
	ВТЗадание.ОбъектСтроительстваПредставление КАК ОбъектСтроительства,
	ВЫБОР
		КОГДА ВТЗадание.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
			ТОГДА "Данные не заполнены"
		ИНАЧЕ ВТЗадание.Номенклатура
	КОНЕЦ КАК Груз,
	ВЫБОР
		КОГДА ВТЗадание.Маршрут = ЗНАЧЕНИЕ(Справочник.уатМаршруты.ПустаяСсылка)
			ТОГДА "Данные не заполнены"
		ИНАЧЕ ВТЗадание.Маршрут
	КОНЕЦ КАК Маршрут,
	ВТЗадание.КоличествоЕздок КАК КоличествоЕздок,
	ЦЕЛ(ВТЗадание.КоличествоКмГруз) + ЦЕЛ(ВТЗадание.КоличествоКмПорожний) КАК Расстояние,
	ВТЗадание.КоличествоТонн КАК ОбъёмТонн,
	МАКСИМУМ(втВремяВыработкиСотрудника.ВремяДневное) КАК ВремяДневное,
	МАКСИМУМ(втВремяВыработкиСотрудника.ВремяНочное) КАК ВремяНочное
ИЗ
	ВТШапкаДокумента КАК ВТШапкаДокумента
		ЛЕВОЕ СОЕДИНЕНИЕ ВТВыработкаТС КАК ВТВыработкаТС
			ЛЕВОЕ СОЕДИНЕНИЕ ВТЗадание КАК ВТЗадание
			ПО ВТВыработкаТС.Ссылка = ВТЗадание.Ссылка
		ПО ВТШапкаДокумента.Ссылка = ВТВыработкаТС.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ втВремяВыработкиСотрудника КАК втВремяВыработкиСотрудника
		ПО (ВТВыработкаТС.Ссылка = втВремяВыработкиСотрудника.Ссылка)
ГДЕ
	НЕ ВТВыработкаТС.Ссылка.ПометкаУдаления
	И ВТВыработкаТС.Ссылка.Проведен
	И НЕ ВТЗадание.Ссылка.ПометкаУдаления
	И ВТЗадание.Ссылка.Проведен
	И НЕ ВТШапкаДокумента.Ссылка.ПометкаУдаления
	И ВТШапкаДокумента.Ссылка.Проведен

СГРУППИРОВАТЬ ПО
	ВТШапкаДокумента.Водитель1,
	ВТШапкаДокумента.Ссылка,
	ВТЗадание.ОбъектСтроительстваКод,
	ВТЗадание.ОбъектСтроительстваПредставление,
	ВТЗадание.КоличествоТонн,
	НАЧАЛОПЕРИОДА(ВТШапкаДокумента.ДатаВыезда, ДЕНЬ),
	НАЧАЛОПЕРИОДА(ВТШапкаДокумента.ДатаЗакрытия, ДЕНЬ),
	ЦЕЛ(ВТЗадание.КоличествоКмГруз) + ЦЕЛ(ВТЗадание.КоличествоКмПорожний),
	ВТШапкаДокумента.РегистрационныйНомер,
	ВТЗадание.КоличествоЕздок,
	ВЫБОР
		КОГДА ВТЗадание.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
			ТОГДА "Данные не заполнены"
		ИНАЧЕ ВТЗадание.Номенклатура
	КОНЕЦ,
	ВЫБОР
		КОГДА ВТЗадание.Маршрут = ЗНАЧЕНИЕ(Справочник.уатМаршруты.ПустаяСсылка)
			ТОГДА "Данные не заполнены"
		ИНАЧЕ ВТЗадание.Маршрут
	КОНЕЦ,
	ВЫБОР
		КОГДА ВТШапкаДокумента.ТранспортноеСредствоТипТС = ЗНАЧЕНИЕ(Справочник.уатТипыТС.ПустаяСсылка)
			ТОГДА "Данные не заполнены"
		ИНАЧЕ ВТШапкаДокумента.ТранспортноеСредствоТипТС
	КОНЕЦ

УПОРЯДОЧИТЬ ПО
	ДатаВыезда
